pool:
  vmImage: 'ubuntu latest'

variables:
  CI: true
  matrix: "{'challenge_cleanup': {'PACKAGE': 'challenge_cleanup'}, 'challenge_demo': {'PACKAGE': 'challenge_demo'}}"

steps:
  - script: |
      wget https://raw.githubusercontent.com/tue-robotics/tue-env/master/ci/install-package.sh
      wget https://raw.githubusercontent.com/tue-robotics/tue-env/master/ci/build-package.sh
      wget https://raw.githubusercontent.com/tue-robotics/tue-env/master/ci/packages.sh
    displayName: 'wget CI scripts'
  - task: Bash@3
    inputs:
      filePath: 'packages.sh'
      arguments: 'tue_robocup'
    displayName: 'Determine packages to be build'
  - task: Bash@3
    inputs:
      filePath: 'install-package.sh'
      arguments: '--package=$PACKAGE --branch=${SYSTEM_PULLREQUEST_SOURCEBRANCH:-${SYSTEM_PULLREQUEST_TARGETBRANCH:-$BUILD_SOURCEBRANCH}} --commit=${BUILD_SOURCEVERSION:-$(git rev-parse HEAD^2)} --pullrequest=${SYSTEM_PULLREQUEST_PULLREQUESTNUMBER:-false}'
    displayName: 'install'
  - task: Bash@3
    inputs:
      filePath: 'build-package.sh'
      arguments: '--package=$PACKAGE'
    displayName: 'build & tests'

strategy:
  matrix: $[ variables.matrix ]
